<!-- docs/biz_process.md -->

# Бизнес-процесс «Запись пациента к врачу»

## 1. Участники и роли

| Роль            | Описание | Доступ к данным (CRUD) |
|-----------------|----------|------------------------|
| **Пациент**     | Человек, желающий записаться на приём. | **C**reate (POST) – создаёт свою запись.<br/>R – получает подтверждение (GET по ID, если ID известен). |
| **Регистратор** | Сотрудник регистратуры, записывает пациентов по телефону или на ресепшен. | C – создаёт запись вместо пациента.<br/>R – просматривает любые записи врача или пациента.<br/>U – может перенести или исправить запись.<br/>D – отменить запись. |
| **Врач**        | Получает расписание, принимает пациентов. | R – читает свои записи (список). |
| **Администратор клиники** | Управляет пользователями, тарифами, расписанием работы врачей. | Полный CRUD. |
| **Интеграционный сервис напоминаний** | Рассылает SMS/e-mail за сутки до приёма. | R – читает записи на нужную дату. |

> **C** – create, **R** – read, **U** – update, **D** – delete.

---

## 2. Основной сценарий (AS-IS)

1. **Пациент** инициирует запись (веб-форма, мобильное приложение или Telegram-бот).  
2. **Интерфейс** запрашивает симптомы → с помощью LLM определяет подходящую специальность.  
3. Отправляется запрос в **Appointments API**:  
   * получить свободные слоты врача;  
   * создать запись (`POST /appointments`).  
4. **API** проверяет уникальное ограничение `(doctor_id, start_time)`.  
5. **БД Postgres** сохраняет запись, возвращается подтверждение.  
6. Интерфейс показывает пациенту талон (дата, время, врач).  
7. **Сервис напоминаний** накануне читает записи и шлёт напоминание.

---

## 3. Альтернативные потоки

| Ситуация | Действия |
|----------|----------|
| Слот занят (409) | Интерфейс предлагает пациенту выбрать другое время. |
| Пациент отменяет запись | Регистратор или пациент (через бот) отправляет DELETE /appointments/{id}. |
| Перенос | PATCH /appointments/{id} меняет `start_time` (проверка уникальности повторяется). |

---

## 4. Диаграмма (Miro)

Полная BPMN-диаграмма размещена в Miro:  
<https://miro.com/app/board/uXjVNFjABCDEFG123/>

> Если доступ к Miro ограничен, PNG-экспорт с тем же содержанием лежит в `docs/biz_process.png`.

---

## 5. Будущие улучшения

* Добавить авторизацию (JWT) для разграничения CRUD-прав.  
* Выделить сервис расписания врачей, чтобы API записей не проверял слоты самостоятельно.  
* Логику напоминаний вынести в отдельную очередь + worker.
